---
import RankingContainer from "../components/RankingContainer.astro";
import LoadingAnimation from "../components/LoadingAnimation.astro";
import BaseLayout from "../layouts/BaseLayout.astro";
import overviewData from "../assets/overview.json";
---

<BaseLayout title="Transcription Factor Rankings - nf-core/tfactivity report" active="rankings">
  <!-- Loading Animation -->
  <LoadingAnimation 
    title="Initializing Rankings"
    subtitle="Processing transcription factor data and calculating scores..."
    containerId="loading-overlay"
  />

  <!-- Main Content (initially hidden) -->
  <div id="main-content" style="display: none;">
    <div class="max-w-6xl mx-auto mb-8">
      <div class="bg-white rounded-lg shadow-lg p-8">
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-gray-900 mb-4">Transcription Factor Rankings</h1>
          <p class="text-gray-600 text-lg">
            This page shows the ranking of transcription factors based on their activity scores 
            across different chromatin assays and target genes.
          </p>
        </div>
        <RankingContainer overviewData={overviewData} />
      </div>
    </div>
  </div>

  <!-- Loading state management script -->
  <script>
    // Override the initializeComponent function to handle loading state
    document.addEventListener('DOMContentLoaded', () => {
      // Wait for the ranking container to be ready
      const checkRankingReady = () => {
        // Check if the ranking container script has executed
        const rankingContainer = document.getElementById('ranking-container');
        const loadingOverlay = document.getElementById('loading-overlay');
        const mainContent = document.getElementById('main-content');
        
        if (rankingContainer && loadingOverlay && mainContent) {
          // Add a small delay to ensure smooth transition
          setTimeout(() => {
            // Hide loading animation
            loadingOverlay.style.transition = 'opacity 0.5s ease-out';
            loadingOverlay.style.opacity = '0';
            
            setTimeout(() => {
              loadingOverlay.style.display = 'none';
              
              // Show main content with fade in
              mainContent.style.display = 'block';
              mainContent.style.opacity = '0';
              mainContent.style.transition = 'opacity 0.5s ease-in';
              
              // Trigger the fade in
              setTimeout(() => {
                mainContent.style.opacity = '1';
              }, 10);
            }, 500);
          }, 800); // Give some time for ranking initialization
        } else {
          // If not ready yet, check again
          setTimeout(checkRankingReady, 100);
        }
      };
      
      // Start checking after DOM is loaded
      checkRankingReady();
    });
  </script>
</BaseLayout>
